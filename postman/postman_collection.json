{
            "info": {
              "name": "Order + Inventory Happy Path",
              "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
            },
            "variable": [
              {"key": "baseUrl", "value": "http://localhost:8081"},
              {"key": "orderId", "value": "", "type": "string"},
              {"key": "payLedgerBaseUrl", "value": "http://localhost:8083"},
              {"key": "paymentIntentId", "value": ""},
              {"key": "inventoryBaseUrl", "value": "http://localhost:8082"},
              {"key": "idempotencyKey", "value": "chaos-dup-001"},
              {"key": "dlqMessageId", "value": ""}
            ],
            "item": [
              {
                "name": "Create order",
                "request": {
                  "method": "POST",
                  "header": [{"key": "Content-Type", "value": "application/json"}],
                  "url": {"raw": "{{baseUrl}}/orders", "host": ["{{baseUrl}}"], "path": ["orders"]},
                  "body": {"mode": "raw", "raw": "{\n  \"customerId\": \"cust-123\",\n  \"orderItems\": [{\"sku\": \"sku-100\",\"quantity\": 1}]\n}"}
                },
                "event": [{"listen": "test", "script": {"exec": ["var responseData = pm.response.json();", "console.log('Full response:', JSON.stringify(responseData, null, 2));", "pm.collectionVariables.set('orderId', responseData.orderId);", "console.log('orderId set to:', pm.collectionVariables.get('orderId'));", "pm.test('order created and id set', () => {", "  pm.response.to.have.status(201);", "  pm.expect(responseData.orderId).to.exist;", "});"]}}]
              },
              {
                "name": "Confirm order",
                "request": {
                  "method": "POST",
                  "header": [],
                  "url": {"raw": "{{baseUrl}}/orders/{{orderId}}/confirm", "host": ["{{baseUrl}}"], "path": ["orders", "{{orderId}}", "confirm"]}
                },
                "event": [
                  {"listen": "test", "script": {"exec": ["pm.test('order confirmed', () => {", "  pm.response.to.have.status(200);", "});", "pm.test('order status is CONFIRMED', () => {", "  const body = pm.response.json();", "  pm.expect(body.status).to.eql('CONFIRMED');", "});"]}}
                ]
              },
              {
                "name": "Get order (expect RESERVED)",
                "request": {
                  "method": "GET",
                  "header": [],
                  "url": {"raw": "{{baseUrl}}/orders/{{orderId}}", "host": ["{{baseUrl}}"], "path": ["orders", "{{orderId}}"]}
                },
                "event": [{"listen": "test", "script": {"exec": ["pm.test('order reserved', () => {", "  pm.response.to.have.status(200);", "});"]}}]
              },
              {
                "name": "Payments",
                "item": [
                  {
                    "name": "Create payment intent",
                    "request": {
                      "method": "POST",
                      "header": [{"key": "Content-Type", "value": "application/json"}],
                      "url": {"raw": "{{payLedgerBaseUrl}}/payments/intents", "host": ["{{payLedgerBaseUrl}}"], "path": ["payments", "intents"]},
                      "body": {"mode": "raw", "raw": "{\n  \"orderId\": \"{{orderId}}\",\n  \"amount\": 19.99,\n  \"currency\": \"USD\"\n}"}
                    },
                    "event": [{"listen": "test", "script": {"exec": ["pm.test('payment intent created', () => {", "  pm.response.to.have.status(201);", "});", "var data = pm.response.json();", "pm.collectionVariables.set('paymentIntentId', data.id);", "pm.test('payment intent id set', () => pm.expect(data.id).to.exist);", "pm.test('payment intent status created', () => pm.expect(data.status).to.eql('CREATED'));"]}}]
                  },
                  {
                    "name": "Capture payment intent",
                    "request": {
                      "method": "POST",
                      "header": [],
                      "url": {"raw": "{{payLedgerBaseUrl}}/payments/intents/{{paymentIntentId}}/capture", "host": ["{{payLedgerBaseUrl}}"], "path": ["payments", "intents", "{{paymentIntentId}}", "capture"]}
                    },
                    "event": [{"listen": "test", "script": {"exec": ["pm.test('payment intent captured', () => {", "  pm.response.to.have.status(200);", "  const body = pm.response.json();", "  pm.expect(body.status).to.eql('CAPTURED');", "});"]}}]
                  },
                  {
                    "name": "Get payment intent",
                    "request": {
                      "method": "GET",
                      "header": [],
                      "url": {"raw": "{{payLedgerBaseUrl}}/payments/intents/{{paymentIntentId}}", "host": ["{{payLedgerBaseUrl}}"], "path": ["payments", "intents", "{{paymentIntentId}}"]}
                    },
                    "event": [{"listen": "test", "script": {"exec": ["pm.test('payment intent fetched', () => {", "  pm.response.to.have.status(200);", "  const body = pm.response.json();", "  pm.expect(body.id).to.eql(pm.collectionVariables.get('paymentIntentId'));", "});"]}}]
                  }
                ]
              },
              {
                "name": "Chaos Demo",
                "item": [
                  {
                    "name": "Trigger inventory failure (next reservation)",
                    "request": {
                      "method": "POST",
                      "header": [{"key": "Content-Type", "value": "application/json"}],
                      "url": {"raw": "{{inventoryBaseUrl}}/ops/chaos/inventory/fail-next", "host": ["{{inventoryBaseUrl}}"], "path": ["ops", "chaos", "inventory", "fail-next"]},
                      "body": {"mode": "raw", "raw": "{\n \"reason\": \"Demo inventory failure\"\n}"}
                    },
                    "event": [{"listen": "test", "script": {"exec": ["pm.test('inventory failure triggered', () => {", "  pm.response.to.have.status(202);", "});", "pm.test('response is accepted', () => {", "  pm.expect(pm.response.code).to.be.oneOf([200, 202]);", "});"]}}]
                  },
                  {
                    "name": "Crash inventory consumer (simulate crash)",
                    "request": {
                      "method": "POST",
                      "header": [{"key": "Content-Type", "value": "application/json"}],
                      "url": {"raw": "{{inventoryBaseUrl}}/ops/chaos/consumer-crash", "host": ["{{inventoryBaseUrl}}"], "path": ["ops", "chaos", "consumer-crash"]},
                      "body": {"mode": "raw", "raw": "{\n \"durationSeconds\": 15\n}"}
                    },
                    "event": [{"listen": "test", "script": {"exec": ["pm.test('consumer crash triggered', () => {", "  pm.response.to.have.status(202);", "});", "pm.test('response is accepted', () => {", "  pm.expect(pm.response.code).to.be.oneOf([200, 202]);", "});"]}}]
                  },
                  {
                    "name": "Create order (duplicate request)",
                    "request": {
                      "method": "POST",
                      "header": [{"key": "Content-Type", "value": "application/json"}, {"key": "Idempotency-Key", "value": "{{idempotencyKey}}"}],
                      "url": {"raw": "{{baseUrl}}/orders", "host": ["{{baseUrl}}"], "path": ["orders"]},
                      "body": {"mode": "raw", "raw": "{\n  \"customerId\": \"cust-dup\",\n  \"orderItems\": [{\"sku\": \"sku-dup\",\"quantity\": 1}]\n}"}
                    },
                    "event": [{"listen": "test", "script": {"exec": ["pm.test('duplicate request accepted', () => {", "  pm.response.to.have.status(201);", "});", "var data = pm.response.json();", "if (data.orderId) {", "  pm.collectionVariables.set('orderId', data.orderId);", "}"]}}]
                  }
                ]
              }
            ]
          }